@model AtribuirPapelViewModel
@using IM2B.ViewModels.Filme

@{
    ViewData["Title"] = "Atribuir Ator ao Filme";
    // ViewBag.Atores = lista de atores disponíveis para dropdown
    // ViewBag.AtoresAtuais = lista de atores já ligados ao filme (List<AtorViewModel>)
}

<div class="hero-section">
    <div class="container">
        <h2 class="mb-3"><i class="fas fa-user-plus"></i> Atribuir Ator ao Filme</h2>
        <p class="text-secondary">Preencha os dados do ator para este filme.</p>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card bg-dark text-light border-warning mb-4">
            <div class="card-body">
                <form asp-action="AtribuirPapel" method="post">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                    @* Hidden field to bind FilmeId *@
                    <input type="hidden" asp-for="FilmeId" />

                    <div class="form-group mb-3">
                        <label asp-for="AtorId" class="form-label">
                            <i class="fas fa-user"></i> Selecionar Ator
                        </label>
                        <select asp-for="AtorId" class="form-select bg-dark text-light border-secondary">
                            <option value="">-- Escolha um ator --</option>
                            @if (ViewBag.Atores != null)
                            {
                                foreach (var ator in ViewBag.Atores)
                                {
                                    <option value="@ator.Id">@ator.Nome</option>
                                }
                            }
                        </select>
                        <span asp-validation-for="AtorId" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="Personagem" class="form-label">
                            <i class="fas fa-id-badge"></i> Personagem
                        </label>
                        <input asp-for="Personagem" class="form-control bg-dark text-light border-secondary" placeholder="Nome do personagem" />
                        <span asp-validation-for="Personagem" class="text-danger"></span>
                    </div>

                    <div class="form-check mb-3">
                        <input asp-for="Principal" class="form-check-input" type="checkbox" />
                        <label asp-for="Principal" class="form-check-label">
                            <i class="fas fa-star"></i> Papel Principal
                        </label>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check"></i> Atribuir
                        </button>
                        <a asp-action="Details" asp-route-id="@Model.FilmeId" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card bg-dark text-light border-warning">
            <div class="card-header bg-imdb">
                <h4 class="mb-0"><i class="fas fa-users"></i> Atores Atuais</h4>
            </div>
            <div class="card-body">
                @if (ViewBag.AtoresAtuais != null && ((List<AtorViewModel>)ViewBag.AtoresAtuais).Any())
                {
                    <ul class="list-group list-group-flush">
                        @foreach (var ator in (List<AtorViewModel>)ViewBag.AtoresAtuais)
                        {
                            <li class="list-group-item bg-dark text-light d-flex justify-content-between align-items-center">
                                <span>
                                    @ator.Nome
                                    @if (!string.IsNullOrWhiteSpace(ator.Personagem))
                                    {
                                        <small class="text-secondary"> — @ator.Personagem</small>
                                    }
                                    @if (ator.Principal)
                                    {
                                        <i class="fas fa-star text-warning ms-2" title="Principal"></i>
                                    }
                                </span>

                                <form asp-action="RemoverAtor"
                                      asp-controller="Filme"
                                      method="post"
                                      class="m-0">
                                    @Html.AntiForgeryToken()

                                    <input type="hidden" name="filmeId" value="@Model.FilmeId" />
                                    <input type="hidden" name="atorId" value="@ator.Id" />

                                    <button type="submit"
                                            class="btn btn-danger btn-sm"
                                            title="Remover ator do filme"
                                            onclick="return confirm('Tem a certeza que deseja remover este ator do filme?');">
                                        <i class="fas fa-trash"></i> Remover
                                    </button>
                                </form>
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <span class="text-secondary fw-semibold">Nenhum ator associado a este filme ainda.</span>
                }

                else
                {
                    <span class="text-secondary">Nenhum ator associado a este filme ainda.</span>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
